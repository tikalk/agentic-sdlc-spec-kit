You are tasked with creating a detailed feature specification.

USER REQUIREMENTS:
{{ user_input }}

CRITICAL: First, identify if this is a SECURITY-CRITICAL feature by checking for:
- Authentication/authorization systems
- Payment processing, credit cards, financial transactions
- Personal Identifiable Information (PII) handling
- Healthcare/medical data
- User sessions or sensitive data storage

If YES â†’ Section 4 (Non-Functional Requirements) MUST comprehensively address ALL security concerns.

INSTRUCTIONS:
Create a comprehensive feature specification document with the following structure.

IMPORTANT: Use ## (level 2) markdown headers for ALL major sections below:

## 1. Overview Section
Brief description of the feature

## 2. User Stories
5+ prioritized user stories (P1, P2, P3) with:
   - Clear "As a [role], I want [feature], so that [benefit]" format
   - Detailed acceptance criteria in Given/When/Then format
   - Independent testability for each story

## 3. Functional Requirements
Specific, measurable, testable requirements (FR-001, FR-002, etc.)

## 4. Non-Functional Requirements
Performance, security, scalability requirements (NFR-001, NFR-002, etc.)

   ðŸ”’ SECURITY REQUIREMENTS (MANDATORY for authentication/payments/PII/healthcare):
   You MUST include ALL of the following security requirements:
     * NFR-SEC-001: Authentication mechanisms (describe WHAT, not HOW - no JWT/OAuth specifics)
     * NFR-SEC-002: Authorization and access control requirements
     * NFR-SEC-003: Encryption requirements (data at rest and in transit)
     * NFR-SEC-004: Input validation and sanitization (prevent injection attacks)
     * NFR-SEC-005: Session management requirements
     * NFR-SEC-006: Data protection and privacy controls
     * NFR-SEC-007: Audit logging and monitoring
     * NFR-SEC-008: Compliance (PCI-DSS for payments, GDPR for PII, HIPAA for healthcare)

   Example NFR-SEC-003 for payments: "All credit card data must be encrypted during transmission and storage. Payment information must never be logged in plaintext."
   - For performance-critical features, specify measurable targets:
     * Response time requirements (e.g., "API response < 200ms at p95")
     * Throughput requirements (e.g., "Handle 1000 requests/second")
     * Concurrent user limits (e.g., "Support 10,000 simultaneous users")

## 5. Edge Cases
Document boundary conditions and error scenarios:
   - For multi-step flows (checkout, onboarding, wizards), include:
     * Failed transitions between steps (payment declined, timeout, network errors)
     * State recovery and rollback scenarios
     * Concurrent user actions (e.g., modifying cart during checkout)
     * Session expiration handling
   - For data input features, include:
     * Boundary values (min/max, empty, very large inputs)
     * Invalid formats and data types
     * Special characters and injection attempts
   - For integration points, include:
     * External service failures (API down, timeout, rate limiting)
     * Partial failures and retry logic

## 6. Success Criteria
Measurable outcomes (SC-001, SC-002, etc.)

IMPORTANT CONSTRAINTS:
- Do NOT include technical implementation details (no specific frameworks, libraries, or tech stack)
- Focus on WHAT needs to be built, not HOW to build it
- All requirements must be measurable and testable
- âš ï¸  VAGUE TERMS: Any unmeasurable terms (fast, scalable, user-friendly, robust, performant, good, intuitive, etc.) MUST either:
  1. Be quantified with specific metrics (e.g., "fast" â†’ "response time < 200ms at p95")
  2. Be flagged with [NEEDS CLARIFICATION] if metrics are unknown
  Example: "The system should be fast [NEEDS CLARIFICATION: target response time?]"
- For complex multi-step features (checkout, onboarding), ensure COMPLETE coverage:
  * All steps in the flow documented
  * NFRs for each critical step (security for payment, performance for cart operations)
  * Edge cases for each transition (what happens if step fails, timeout, etc.)
  * Success criteria for the entire flow

OUTPUT: A complete feature specification document.